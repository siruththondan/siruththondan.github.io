document.addEventListener("DOMContentLoaded",function(){function e(e){let n=0,s=0;for(;e.startsWith(".");)n++,e=e.substring(1);for(;e.endsWith("'");)s++,e=e.slice(0,-1);const t=document.createElement("span");return t.className="swara-cell",n===1&&t.classList.add("mandra"),n>=2&&t.classList.add("anumandra"),s===1&&t.classList.add("tara"),s>=2&&t.classList.add("atitara"),t.innerText=e,t}function t(e){const o=e.dataset.mode;if(o==="custom"){const t=parseInt(e.dataset.groups),n=parseInt(e.dataset.perGroup);return!t||!n?[]:Array(t).fill(n)}const i={Thisra:3,Chatusra:4,Khanda:5,Misra:7,Sankeerna:9},a={Dhruva:["laghu","dhrutam","laghu","laghu"],Matya:["laghu","dhrutam","laghu"],Rupaka:["dhrutam","laghu"],Jhampa:["laghu","anudhrutam","dhrutam"],Triputa:["laghu","dhrutam","dhrutam"],Ata:["laghu","laghu","dhrutam","dhrutam"],Eka:["laghu"]},n=a[e.dataset.thalam],s=i[e.dataset.jaathi];if(!n||!s)return[];let t=[];return n.forEach(e=>{e==="laghu"&&t.push(s),e==="dhrutam"&&t.push(2),e==="anudhrutam"&&t.push(1)}),t}document.querySelectorAll(".swara-block").forEach(n=>{const s=t(n),o=n.dataset.doubleBar==="true";n.querySelectorAll(".swara-line").forEach(t=>{const n=t.querySelector(".swara-content"),c=n.innerText.trim(),i=c.split(/\s+/).filter(Boolean);n.innerHTML="";let a=0;s.forEach((t,r)=>{for(let s=0;s<t&&a<i.length;s++)n.appendChild(e(i[a++]));const c=document.createElement("span");r===s.length-1&&o?(c.innerText=" || ",c.className="tala-double"):(c.innerText=" | ",c.className="tala-single"),n.appendChild(c)});const r=s.reduce((e,t)=>e+t,0);if(i.length!==r){t.classList.add("swara-error");const e=t.querySelector(".swara-warning");e&&(e.innerText=`Expected ${r} swaras, found ${i.length}`)}})})})